
<!DOCTYPE html>
<html>
    <title>render_mini</title>
    <meta charset="UTF-8">

    <body>

        <div style='color:#000' >Control: <b>1</b> or <b>2</b> change scene, <b>Q</b> or <b>E</b> rotate camera, <b>W</b> or <b>S</b> scroll speed, <b>A</b> or <b>D</b> tilt camera</div>

        <div style='color:#FF0000' id="result">Wait...</div>

        <canvas tabindex='1' id="myCanvas" width="30" height="15" style="border:1px solid #d3d3d3;" onkeypress="return processKeyEvent(event)">
            Your browser does not support the HTML5 canvas tag.</canvas>

        <script type="text/javascript" src="render_mini.js">
        </script>
        <script type="text/javascript">


            function processKeyEvent(e) {
                Gg2.keyDown[window.event ? event.keyCode : e.which] = true;

                if (Gg2.keyDown[Gg2.key_1]) {
                    Gg2.keyDown[Gg2.key_1] = false;
                    Gg2.scene = 1;

                }
                if (Gg2.keyDown[Gg2.key_2]) {
                    Gg2.keyDown[Gg2.key_2] = false;
                    Gg2.scene = 2;

                }

                if (Gg2.keyDown[Gg2.key_W]) {
                    Gg2.keyDown[Gg2.key_W] = false;
                    Gg2.speed = (Gg2.speed < 0.3) ? Gg2.speed + 0.05 : 0.35;

                }

                if (Gg2.keyDown[Gg2.key_S]) {
                    Gg2.keyDown[Gg2.key_S] = false;
                    Gg2.speed = (Gg2.speed > 0.06) ? Gg2.speed - 0.05 : 0;

                }
                if (Gg2.keyDown[Gg2.key_A]) {
                    Gg2.keyDown[Gg2.key_A] = false;
                    if (Gg2.rightm == 0) {
                        Gg2.leftm = (Gg2.leftm < 0.9) ? Gg2.leftm + 0.08 : 0.91;
                    } else {
                        Gg2.rightm = ((Gg2.rightm - 0.08) > 0) ? Gg2.rightm - 0.08 : 0;
                    }
                }

                if (Gg2.keyDown[Gg2.key_D]) {
                    Gg2.keyDown[Gg2.key_D] = false;
                    if (Gg2.leftm == 0) {
                        Gg2.rightm = (Gg2.rightm < 0.9) ? Gg2.rightm + 0.08 : 0.91;
                    } else {
                        Gg2.leftm = ((Gg2.leftm - 0.08) > 0) ? Gg2.leftm - 0.08 : 0;
                    }
                }

                if (Gg2.keyDown[Gg2.key_Q]) {
                    Gg2.keyDown[Gg2.key_Q] = false;
                    Gg2.zz = (Gg2.zz < 0.0055) ? Gg2.zz + 0.0005 : 0.006;
                }

                if (Gg2.keyDown[Gg2.key_E]) {
                    Gg2.keyDown[Gg2.key_E] = false;
                    Gg2.zz = ((Gg2.zz - 0.0005) > -0.0055) ? Gg2.zz -= 0.0005 : -0.006;
                }
                return true;
            }

    const viewWidth = 300
	const viewHeight = 200
	const viewScaleX = 3
	const viewScaleY = 3
	let canvaswidth = viewWidth*viewScaleX
	let canvasheight = viewHeight*viewScaleY
	var c = document.getElementById("myCanvas");
    c.setAttribute("width", "" + canvaswidth);
    c.setAttribute("height", "" + canvasheight);

   image = c.getContext('2d', {alfa:false});

		const pixels = new Uint32Array(new ArrayBuffer(viewWidth * viewHeight * 4))
		
			let buffer = new Uint8ClampedArray(new ArrayBuffer(canvaswidth*canvasheight*4))
		
	const js_draw = () => {	
		for (let i = 0; i < viewWidth; i++) {
            for (let j = 0, s; j < viewHeight; j++) {
            	s = Gg2.pixels[j * viewWidth + i]
                        for (let o_y = 0; o_y < viewScaleY; ++o_y)
                            for (let o_x = 0; o_x < viewScaleX; ++o_x) {
                            	let n = (viewScaleX * i + o_x) * 4 + (viewScaleY * j + o_y) * (viewWidth*viewScaleX*4)
                            	buffer[n+0] = s >> 16
                            	buffer[n+1] = (s >> 8) - (buffer[n] << 8)
                            	buffer[n+2] = s - ((s >> 8) << 8)
                            	buffer[n+3] = 0xff
                            }
                    }
                }
                
        image.putImageData(new ImageData(buffer, canvaswidth, canvasheight), 0, 0)
        Gg2.run();
        document.getElementById("result").textContent = "fps:" + fps + " , timetocalc:" + Gg2.frame_timetocalc + " ,  max:" + Gg2.max_timetocalc + " , min:" + Gg2.min_timetocalc;
        requestAnimationFrame(js_draw);
        
	}
            js_draw();
        </script>



    </body>
</html>
